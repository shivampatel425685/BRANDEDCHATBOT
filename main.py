from pyrogram import Client, filters
from pyrogram.types import *
from pymongo import MongoClient
from pyrogram.enums import ChatAction
import requests
import random
from random import choice
import os
import re
import asyncio
import time
from datetime import datetime
from pyrogram import enums
API_ID = os.environ.get("API_ID", None) 
API_HASH = os.environ.get("API_HASH", None) 
BOT_TOKEN = os.environ.get("BOT_TOKEN", None) 
MONGO_URL = os.environ.get("MONGO_URL", None)
BOT_USERNAME = os.environ.get("BOT_USERNAME","") 
UPDATE_CHNL = os.environ.get("UPDATE_CHNL","BRANDRD_BOT")
OWNER_USERNAME = os.environ.get("OWNER_USERNAME","BRANDEDKING82")
SUPPORT_GRP = os.environ.get("SUPPORT_GRP","BRANDED_WORLD")
BOT_NAME = os.environ.get("BOT_NAME","CHATBOT")
START_IMG = os.environ.get("START_IMG","")

STKR = os.environ.get("STKR")


StartTime = time.time()
BRANDEDCHAT = Client(
    "chat-bot" ,
    api_id = API_ID,
    api_hash = API_HASH ,
    bot_token = BOT_TOKEN
)

@BRANDEDCHAT.on_message(filters.command("start"))
async def start(client, message):
    self = await BRANDEDCHAT.get_me()
    busername = self.username
    if message.chat.type != "private":
        buttons = [
                  [
                   InlineKeyboardButton("á´œá´˜á´…á´€á´›á´‡s", url="https://t.me/BRANDRD_BOT"),
                   InlineKeyboardButton("sá´œá´˜á´˜á´Ê€á´›", url="https://t.me/BRANDED_WORLD"),
                  ]       
                  ]
        await message.reply("á´„á´É´á´›á´€á´„á´› á´á´‡ ÉªÉ´ á´˜á´‡Ê€sá´É´á´€ÊŸ", reply_markup=buttons)
        
    else:
        buttons = [[
            InlineKeyboardButton("â® á´€á´…á´… á´á´‡ á´›á´ Êá´á´œÊ€ É¢Ê€á´á´œá´˜ â¯", url=f"https://t.me/VickMachine82_Bot?startgroup=true")
        ]
        ]
        video = "https://graph.org/file/e999c40cb700e7c684b75.mp4"
        await message.reply_video(video, caption=f"""Êœá´‡ÊŸÊŸá´[{message.from_user.first_name}](tg://user?id={message.from_user.id}),
Éª á´€á´ á´„Êœá´€á´›Ê™á´á´› Ò“á´Ê€ á´›á´‡ÊŸá´‡É¢Ê€á´€á´ É¢Ê€á´á´œá´˜s ...

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”£â˜… ğğ–ğğ„ğ‘   [ğ€ğƒğˆğ“ğ˜ğ€](https://t.me/BRANDEDKING8)
â”£â˜… ğ”ğğƒğ€ğ“ğ„ğ’ [ğ‚ğ‡ğ€ğğğ„ğ‹](https://t.me/BRANDRD_BOT)
â”£â˜… ğ’ğ”ğğğğ‘ğ“ [ğ†ğ‘ğğ”ğ](https://t.me/BRANDED_WORLD)
â”£â˜… ğ’ğğ”ğ‘ğ‚ğ„  [ ğ‘ğ„ğğ](https://github.com/WCGKING/BRANDEDCHATBOT)
â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
""", reply_markup=InlineKeyboardMarkup(buttons))


@BRANDEDCHAT.on_callback_query()
async def cb_handler(Client, query: CallbackQuery):
    if query.data == "HELP":
     await query.message.edit_text(
                      text = HELP_READ,
                      reply_markup = InlineKeyboardMarkup(HELP_BACK),
     )
    elif query.data == "HELP_BACK":
            await query.message.edit(
                  text = START,
                  reply_markup=InlineKeyboardMarkup(MAIN),
        )
    elif query.data == 'source':
        await query.message.edit_text(SOURCE_TEXT, reply_markup=SOURCE_BUTTONS)
    elif query.data == 'hurr':
        await query.answer()
        await query.message.edit_text(SOURCE)
@BRANDEDCHAT.on_message(filters.command(["help", f"help@{BOT_USERNAME}"], prefixes=["","+", ".", "/", "-", "?", "$"]))
async def restart(client, message):
    hmm = await message.reply_photo(START_IMG,
                             caption= HELP_READ,
                        reply_markup= InlineKeyboardMarkup(HELP_BACK),
       )
@BRANDEDCHAT.on_message(filters.command(['source', 'repo']))
async def source(bot, m):
    await m.reply_photo(START_IMG, caption=SOURCE_TEXT, reply_markup=SOURCE_BUTTONS, reply_to_message_id=m.id)
#  alive
@BRANDEDCHAT.on_message(filters.command(["ping","alive"], prefixes=["","+", "/", "-", "?", "$", "&","."]))
async def ping(client, message: Message):
        start = datetime.now()
        t = "__ÏÎ¹Ğ¸gÎ¹Ğ¸g...__"
        txxt = await message.reply(t)
        await asyncio.sleep(0.25)
        await txxt.edit_text("__ÏÎ¹Ğ¸gÎ¹Ğ¸g.....__")
        await asyncio.sleep(0.35)
        await txxt.delete()
        end = datetime.now()
        ms = (end-start).microseconds / 1000
        await message.reply_photo(
                             photo=START_IMG,
                             caption=f"Êœá´‡Ê Ê™á´€Ê™Ê!!\n**[{BOT_NAME}](t.me/{BOT_USERNAME})** Éªêœ± á´€ÊŸÉªá´ á´‡ ğŸ¥€ á´€É´á´… á´¡á´Ê€á´‹ÉªÉ´É¢ êœ°ÉªÉ´á´‡ á´¡Éªá´›Êœ á´˜á´É´É¢ á´êœ° \nâ¥ `{ms}` ms\n\n**á´á´€á´…á´‡ á´¡Éªá´›Êœ â£ï¸ Ê™Ê || [BRANDED KING](https://t.me/BRANDEDKING82)||**",
                             reply_markup=InlineKeyboardMarkup(PNG_BTN),
       )

@BRANDEDCHAT.on_message(
    filters.command(["chatbot off", f"chatbot@{BOT_USERNAME} off"], prefixes=["/", ".", "?", "-"])
    & ~filters.private)
async def chatbotofd(client, message):
    vickdb = MongoClient(MONGO_URL)    
    vick = vickdb["VickDb"]["Vick"]     
    if message.from_user:
        user = message.from_user.id
        chat_id = message.chat.id
        if user not in (
           await is_admins(chat_id)
        ):
           return await message.reply_text(
                "You are not admin"
            )
    is_vick = vick.find_one({"chat_id": message.chat.id})
    if not is_vick:
        vick.insert_one({"chat_id": message.chat.id})
        await message.reply_text(f"Chatbot Disabled!")
    if is_vick:
        await message.reply_text(f"ChatBot Already Disabled")
    

@BRANDEDCHAT.on_message(
    filters.command(["chatbot on", f"chatbot@{BOT_USERNAME} on"] ,prefixes=["/", ".", "?", "-"])
    & ~filters.private)
async def chatboton(client, message):
    vickdb = MongoClient(MONGO_URL)    
    vick = vickdb["VickDb"]["Vick"]     
    if message.from_user:
        user = message.from_user.id
        chat_id = message.chat.id
        if user not in (
            await is_admins(chat_id)
        ):
            return await message.reply_text(
                "You are not admin"
            )
    is_vick = vick.find_one({"chat_id": message.chat.id})
    if not is_vick:           
        await message.reply_text(f"Chatbot Already Enabled")
    if is_vick:
        vick.delete_one({"chat_id": message.chat.id})
        await message.reply_text(f"ChatBot Enabled!")
    

@BRANDEDCHAT.on_message(
    filters.command(["chatbot", f"chatbot@{BOT_USERNAME}"], prefixes=["/", ".", "?", "-"])
    & ~filters.private)
async def chatbot(client, message):
    await message.reply_text(f"**á´œsá´€É¢á´‡:**\n/**chatbot [on/off]**\n**á´„Êœá´€á´›-Ê™á´á´› á´„á´á´á´á´€É´á´…(s) á´¡á´Ê€á´‹ ÉªÉ´ É¢Ê€á´á´œá´˜ á´É´ÊŸÊ!**")


@BRANDEDCHAT.on_message(
 (
        filters.text
        | filters.sticker
    )
    & ~filters.private
    & ~filters.bot,
)
async def vickai(client: Client, message: Message):

   chatdb = MongoClient(MONGO_URL)
   chatai = chatdb["Word"]["WordDb"]   

   if not message.reply_to_message:
       vickdb = MongoClient(MONGO_URL)
       vick = vickdb["VickDb"]["Vick"] 
       is_vick = vick.find_one({"chat_id": message.chat.id})
       if not is_vick:
           await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
           K = []  
           is_chat = chatai.find({"word": message.text})  
           k = chatai.find_one({"word": message.text})      
           if k:               
               for x in is_chat:
                   K.append(x['text'])          
               hey = random.choice(K)
               is_text = chatai.find_one({"text": hey})
               Yo = is_text['check']
               if Yo == "sticker":
                   await message.reply_sticker(f"{hey}")
               if not Yo == "sticker":
                   await message.reply_text(f"{hey}")
   
   if message.reply_to_message:  
       vickdb = MongoClient(MONGO_URL)
       vick = vickdb["VickDb"]["Vick"] 
       is_vick = vick.find_one({"chat_id": message.chat.id})    
       getme = await BRANDEDCHAT.get_me()
       bot_id = getme.id                             
       if message.reply_to_message.from_user.id == bot_id: 
           if not is_vick:                   
               await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
               K = []  
               is_chat = chatai.find({"word": message.text})
               k = chatai.find_one({"word": message.text})      
               if k:       
                   for x in is_chat:
                       K.append(x['text'])
                   hey = random.choice(K)
                   is_text = chatai.find_one({"text": hey})
                   Yo = is_text['check']
                   if Yo == "sticker":
                       await message.reply_sticker(f"{hey}")
                   if not Yo == "sticker":
                       await message.reply_text(f"{hey}")
       if not message.reply_to_message.from_user.id == bot_id:          
           if message.sticker:
               is_chat = chatai.find_one({"word": message.reply_to_message.text, "id": message.sticker.file_unique_id})
               if not is_chat:
                   chatai.insert_one({"word": message.reply_to_message.text, "text": message.sticker.file_id, "check": "sticker", "id": message.sticker.file_unique_id})
           if message.text:                 
               is_chat = chatai.find_one({"word": message.reply_to_message.text, "text": message.text})                 
               if not is_chat:
                   chatai.insert_one({"word": message.reply_to_message.text, "text": message.text, "check": "none"})    
               

@BRANDEDCHAT.on_message(
 (
        filters.sticker
        | filters.text
    )
    & ~filters.private
    & ~filters.bot,
)
async def vickstickerai(client: Client, message: Message):

   chatdb = MongoClient(MONGO_URL)
   chatai = chatdb["Word"]["WordDb"]   

   if not message.reply_to_message:
       vickdb = MongoClient(MONGO_URL)
       vick = vickdb["VickDb"]["Vick"] 
       is_vick = vick.find_one({"chat_id": message.chat.id})
       if not is_vick:
           await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
           K = []  
           is_chat = chatai.find({"word": message.sticker.file_unique_id})      
           k = chatai.find_one({"word": message.text})      
           if k:           
               for x in is_chat:
                   K.append(x['text'])
               hey = random.choice(K)
               is_text = chatai.find_one({"text": hey})
               Yo = is_text['check']
               if Yo == "text":
                   await message.reply_text(f"{hey}")
               if not Yo == "text":
                   await message.reply_sticker(f"{hey}")
   
   if message.reply_to_message:
       vickdb = MongoClient(MONGO_URL)
       vick = vickdb["VickDb"]["Vick"] 
       is_vick = vick.find_one({"chat_id": message.chat.id})
       getme = await BRANDEDCHAT.get_me()
       bot_id = getme.id
       if message.reply_to_message.from_user.id == bot_id: 
           if not is_vick:                    
               await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
               K = []  
               is_chat = chatai.find({"word": message.text})
               k = chatai.find_one({"word": message.text})      
               if k:           
                   for x in is_chat:
                       K.append(x['text'])
                   hey = random.choice(K)
                   is_text = chatai.find_one({"text": hey})
                   Yo = is_text['check']
                   if Yo == "text":
                       await message.reply_text(f"{hey}")
                   if not Yo == "text":
                       await message.reply_sticker(f"{hey}")
       if not message.reply_to_message.from_user.id == bot_id:          
           if message.text:
               is_chat = chatai.find_one({"word": message.reply_to_message.sticker.file_unique_id, "text": message.text})
               if not is_chat:
                   toggle.insert_one({"word": message.reply_to_message.sticker.file_unique_id, "text": message.text, "check": "text"})
           if message.sticker:                 
               is_chat = chatai.find_one({"word": message.reply_to_message.sticker.file_unique_id, "text": message.sticker.file_id})                 
               if not is_chat:
                   chatai.insert_one({"word": message.reply_to_message.sticker.file_unique_id, "text": message.sticker.file_id, "check": "none"})    
               


@BRANDEDCHAT.on_message(
    (
        filters.text
        | filters.sticker
    )
    & filters.private
    & ~filters.bot,
)
async def vickprivate(client: Client, message: Message):

   chatdb = MongoClient(MONGO_URL)
   chatai = chatdb["Word"]["WordDb"]
   if not message.reply_to_message: 
       await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
       K = []  
       is_chat = chatai.find({"word": message.text})                 
       for x in is_chat:
           K.append(x['text'])
       hey = random.choice(K)
       is_text = chatai.find_one({"text": hey})
       Yo = is_text['check']
       if Yo == "sticker":
           await message.reply_sticker(f"{hey}")
       if not Yo == "sticker":
           await message.reply_text(f"{hey}")
   if message.reply_to_message:            
       getme = await BRANDEDCHAT.get_me()
       bot_id = getme.id       
       if message.reply_to_message.from_user.id == bot_id:                    
           await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
           K = []  
           is_chat = chatai.find({"word": message.text})                 
           for x in is_chat:
               K.append(x['text'])
           hey = random.choice(K)
           is_text = chatai.find_one({"text": hey})
           Yo = is_text['check']
           if Yo == "sticker":
               await message.reply_sticker(f"{hey}")
           if not Yo == "sticker":
               await message.reply_text(f"{hey}")
       

@BRANDEDCHAT.on_message(
 (
        filters.sticker
        | filters.text
    )
    & filters.private
    & ~filters.bot,
)
async def vickprivatesticker(client: Client, message: Message):

   chatdb = MongoClient(MONGO_URL)
   chatai = chatdb["Word"]["WordDb"] 
   if not message.reply_to_message:
       await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
       K = []  
       is_chat = chatai.find({"word": message.sticker.file_unique_id})                 
       for x in is_chat:
           K.append(x['text'])
       hey = random.choice(K)
       is_text = chatai.find_one({"text": hey})
       Yo = is_text['check']
       if Yo == "text":
           await message.reply_text(f"{hey}")
       if not Yo == "text":
           await message.reply_sticker(f"{hey}")
   if message.reply_to_message:            
       getme = await BRANDEDCHAT.get_me()
       bot_id = getme.id       
       if message.reply_to_message.from_user.id == bot_id:                    
           await BRANDEDCHAT.send_chat_action(message.chat.id, ChatAction.TYPING)
           K = []  
           is_chat = chatai.find({"word": message.sticker.file_unique_id})                 
           for x in is_chat:
               K.append(x['text'])
           hey = random.choice(K)
           is_text = chatai.find_one({"text": hey})
           Yo = is_text['check']
           if Yo == "text":
               await message.reply_text(f"{hey}")
           if not Yo == "text":
               await message.reply_sticker(f"{hey}")

print(f"{BOT_NAME} Éªs á´€ÊŸÉªá´ á´‡!")      
BRANDEDCHAT.run()
